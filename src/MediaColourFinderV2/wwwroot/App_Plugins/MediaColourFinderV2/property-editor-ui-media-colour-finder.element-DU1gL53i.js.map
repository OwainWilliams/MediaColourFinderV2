{"version":3,"file":"property-editor-ui-media-colour-finder.element-DU1gL53i.js","sources":["../../../Client/node_modules/colorthief/dist/color-thief.mjs","../../../Client/src/mediacolourfinderv2/property-editor-ui-media-colour-finder.element.ts"],"sourcesContent":["var t=function(t,r){return t<r?-1:t>r?1:0},r=function(t){return t.reduce(function(t,r){return t+r},0)},n=/*#__PURE__*/function(){function t(t){this.colors=t}var r=t.prototype;return r.palette=function(){return this.colors},r.map=function(t){return t},t}(),o=function(){function o(t,r,n){return(t<<10)+(r<<5)+n}function e(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function i(t,r,n,o,e,i,u){var a=this;a.r1=t,a.r2=r,a.g1=n,a.g2=o,a.b1=e,a.b2=i,a.histo=u}function u(){this.vboxes=new e(function(r,n){return t(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function a(t,r){if(r.count()){var n=r.r2-r.r1+1,e=r.g2-r.g1+1,i=Math.max.apply(null,[n,e,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var u,a,c,f,s=0,h=[],v=[];if(i==n)for(u=r.r1;u<=r.r2;u++){for(f=0,a=r.g1;a<=r.g2;a++)for(c=r.b1;c<=r.b2;c++)f+=t[o(u,a,c)]||0;h[u]=s+=f}else if(i==e)for(u=r.g1;u<=r.g2;u++){for(f=0,a=r.r1;a<=r.r2;a++)for(c=r.b1;c<=r.b2;c++)f+=t[o(a,u,c)]||0;h[u]=s+=f}else for(u=r.b1;u<=r.b2;u++){for(f=0,a=r.r1;a<=r.r2;a++)for(c=r.g1;c<=r.g2;c++)f+=t[o(a,c,u)]||0;h[u]=s+=f}return h.forEach(function(t,r){v[r]=s-t}),function(t){var n,o,e,i,a,c=t+\"1\",f=t+\"2\",l=0;for(u=r[c];u<=r[f];u++)if(h[u]>s/2){for(e=r.copy(),i=r.copy(),a=(n=u-r[c])<=(o=r[f]-u)?Math.min(r[f]-1,~~(u+o/2)):Math.max(r[c],~~(u-1-n/2));!h[a];)a++;for(l=v[a];!l&&h[a-1];)l=v[--a];return e[f]=a,i[c]=e[f]+1,[e,i]}}(i==n?\"r\":i==e?\"g\":\"b\")}}return i.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(t){var r=this,n=r.histo;if(!r._count_set||t){var e,i,u,a=0;for(e=r.r1;e<=r.r2;e++)for(i=r.g1;i<=r.g2;i++)for(u=r.b1;u<=r.b2;u++)a+=n[o(e,i,u)]||0;r._count=a,r._count_set=!0}return r._count},copy:function(){var t=this;return new i(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var r=this,n=r.histo;if(!r._avg||t){var e,i,u,a,c=0,f=0,s=0,h=0;if(r.r1===r.r2&&r.g1===r.g2&&r.b1===r.b2)r._avg=[r.r1<<3,r.g1<<3,r.b1<<3];else{for(i=r.r1;i<=r.r2;i++)for(u=r.g1;u<=r.g2;u++)for(a=r.b1;a<=r.b2;a++)c+=e=n[o(i,u,a)]||0,f+=e*(i+.5)*8,s+=e*(u+.5)*8,h+=e*(a+.5)*8;r._avg=c?[~~(f/c),~~(s/c),~~(h/c)]:[~~(8*(r.r1+r.r2+1)/2),~~(8*(r.g1+r.g2+1)/2),~~(8*(r.b1+r.b2+1)/2)]}}return r._avg},contains:function(t){var r=this,n=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<r||void 0===r)&&(r=n,o=e.peek(i).color);return o},forcebw:function(){var n=this.vboxes;n.sort(function(n,o){return t(r(n.color),r(o.color))});var o=n[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(n[0].color=[0,0,0]);var e=n.length-1,i=n[e].color;i[0]>251&&i[1]>251&&i[2]>251&&(n[e].color=[255,255,255])}},{quantize:function(r,c){if(!Number.isInteger(c)||c<1||c>256)throw new Error(\"Invalid maximum color count. It must be an integer between 1 and 256.\");if(!r.length||c<2||c>256)return!1;if(!r.length||c<2||c>256)return!1;for(var f=[],s=new Set,h=0;h<r.length;h++){var v=r[h],l=v.join(\",\");s.has(l)||(s.add(l),f.push(v))}if(f.length<=c)return new n(f);var g=function(t){var r,n=new Array(32768);return t.forEach(function(t){r=o(t[0]>>3,t[1]>>3,t[2]>>3),n[r]=(n[r]||0)+1}),n}(r);g.forEach(function(){});var p=function(t,r){var n,o,e,u=1e6,a=0,c=1e6,f=0,s=1e6,h=0;return t.forEach(function(t){(n=t[0]>>3)<u?u=n:n>a&&(a=n),(o=t[1]>>3)<c?c=o:o>f&&(f=o),(e=t[2]>>3)<s?s=e:e>h&&(h=e)}),new i(u,a,c,f,s,h,r)}(r,g),b=new e(function(r,n){return t(r.count(),n.count())});function m(t,r){for(var n,o=t.size(),e=0;e<1e3;){if(o>=r)return;if(e++>1e3)return;if((n=t.pop()).count()){var i=a(g,n),u=i[0],c=i[1];if(!u)return;t.push(u),c&&(t.push(c),o++)}else t.push(n),e++}}b.push(p),m(b,.75*c);for(var d=new e(function(r,n){return t(r.count()*r.volume(),n.count()*n.volume())});b.size();)d.push(b.pop());m(d,c);for(var w=new u;d.size();)w.push(d.pop());return w}}}().quantize,e=function(t){this.canvas=document.createElement(\"canvas\"),this.context=this.canvas.getContext(\"2d\"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var u=function(){};u.prototype.getColor=function(t,r){return void 0===r&&(r=10),this.getPalette(t,5,r)[0]},u.prototype.getPalette=function(t,r,n){var i=function(t){var r=t.colorCount,n=t.quality;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error(\"colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()\");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(void 0===n||!Number.isInteger(n)||n<1)&&(n=10),{colorCount:r,quality:n}}({colorCount:r,quality:n}),u=new e(t),a=function(t,r,n){for(var o,e,i,u,a,c=t,f=[],s=0;s<r;s+=n)e=c[0+(o=4*s)],i=c[o+1],u=c[o+2],(void 0===(a=c[o+3])||a>=125)&&(e>250&&i>250&&u>250||f.push([e,i,u]));return f}(u.getImageData().data,u.width*u.height,i.quality),c=o(a,i.colorCount);return c?c.palette():null},u.prototype.getColorFromUrl=function(t,r,n){var o=this,e=document.createElement(\"img\");e.addEventListener(\"load\",function(){var i=o.getPalette(e,5,n);r(i[0],t)}),e.src=t},u.prototype.getImageData=function(t,r){var n=new XMLHttpRequest;n.open(\"GET\",t,!0),n.responseType=\"arraybuffer\",n.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var n=new Array(i),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);var e=n.join(\"\"),u=window.btoa(e);r(\"data:image/png;base64,\"+u)}},n.send()},u.prototype.getColorAsync=function(t,r,n){var o=this;this.getImageData(t,function(t){var e=document.createElement(\"img\");e.addEventListener(\"load\",function(){var t=o.getPalette(e,5,n);r(t[0],this)}),e.src=t})};export{u as default};\n","import ColorThief from 'colorthief';\r\nimport { customElement, html, nothing, property, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_PROPERTY_DATASET_CONTEXT } from '@umbraco-cms/backoffice/property';\r\nimport type { RGBColor } from 'colorthief';\r\nimport type { UmbImageCropperPropertyEditorValue } from '@umbraco-cms/backoffice/media';\r\nimport type { UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\n\r\ntype MediaColorFinderValue = {\r\n  average?: string;\r\n  brightest?: string;\r\n  opposite?: string;\r\n  textColour?: string;\r\n};\r\n\r\n@customElement('property-editor-ui-media-colour-finder')\r\nexport class WscPropertyEditorUIMediaColorFinderElement extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n  #colorThief = new ColorThief();\r\n\r\n  @state()\r\n  private _imgSrc?: string;\r\n\r\n  @query('#preview')\r\n  private _previewImage?: HTMLImageElement;\r\n\r\n  @state()\r\n  private _average?: string;\r\n\r\n  @state()\r\n  private _brightest?: string;\r\n\r\n  @state()\r\n  private _opposite?: string;\r\n\r\n  @state()\r\n  private _textColour?: string;\r\n\r\n  @state()\r\n  private _focalPoint?: { left: number; top: number };\r\n\r\n  #previousFocalPoint?: { left: number; top: number };\r\n\r\n  // internal parsed object and raw JSON string\r\n  #value?: MediaColorFinderValue | undefined;\r\n  #rawValue?: string | undefined;\r\n  #lastRawValue?: string | undefined;\r\n\r\n  // The backoffice expects the element's `value` to be the raw persisted value (string).\r\n  // Accept either a raw JSON string (from Umbraco) or an object (internal). Getter returns raw string.\r\n  @property({ attribute: false })\r\n  public set value(value: MediaColorFinderValue | string | undefined) {\r\n    if (typeof value === 'string') {\r\n      this.#rawValue = value;\r\n      try {\r\n        this.#value = JSON.parse(value) as MediaColorFinderValue;\r\n      } catch {\r\n        this.#value = undefined;\r\n      }\r\n    } else if (typeof value === 'object' && value !== null) {\r\n      this.#value = value;\r\n      this.#rawValue = JSON.stringify(value);\r\n    } else {\r\n      this.#value = undefined;\r\n      this.#rawValue = undefined;\r\n    }\r\n\r\n    // Populate UI state from parsed object\r\n    if (this.#value) {\r\n      this._average = this.#value.average;\r\n      this._brightest = this.#value.brightest;\r\n      this._opposite = this.#value.opposite;\r\n      this._textColour = this.#value.textColour;\r\n    }\r\n  }\r\n  public get value(): string | undefined {\r\n    // return the raw JSON string (what Umbraco expects to persist)\r\n    return this.#rawValue;\r\n  }\r\n\r\n  public set config(config: UmbPropertyEditorUiElement['config']) {\r\n    if (!config) return;\r\n  }\r\n\r\n  override connectedCallback() {\r\n    super.connectedCallback();\r\n\r\n    this.consumeContext(UMB_PROPERTY_DATASET_CONTEXT, async (propertyDatasetContext) => {\r\n      this.observe(\r\n        await propertyDatasetContext?.propertyValueByAlias<UmbImageCropperPropertyEditorValue>('umbracoFile'),\r\n        (imageCropper) => {\r\n          // Store the previous focal point for comparison\r\n          const newFocalPoint = imageCropper?.focalPoint || { left: 0.5, top: 0.5 };\r\n          const focalPointChanged = !this.#previousFocalPoint ||\r\n            this.#previousFocalPoint.left !== newFocalPoint.left ||\r\n            this.#previousFocalPoint.top !== newFocalPoint.top;\r\n\r\n          this._focalPoint = newFocalPoint;\r\n          this.#previousFocalPoint = { ...newFocalPoint };\r\n\r\n          if (imageCropper?.temporaryFileId) {\r\n            // If there's a temporary file ID, we'll traverse the DOM to get the temporary image src (blob URL).\r\n            this.#getTemporaryImageSrc();\r\n          } else {\r\n            // Otherwise, the media item exists, and we'll use the image src.\r\n            const srcChanged = this._imgSrc !== imageCropper?.src;\r\n            this._imgSrc = imageCropper?.src;\r\n\r\n            // If focal point changed and we have an image, recalculate colors\r\n            if (focalPointChanged && this._imgSrc && this._previewImage && !srcChanged) {\r\n              this.#calculateColors();\r\n            }\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // https://stackoverflow.com/a/50146979/12787\r\n  #convertRgbToHex(rgb: RGBColor): string {\r\n    const toHex = (c: number): string => {\r\n      var hex = c.toString(16);\r\n      return hex.length === 1 ? '0' + hex : hex;\r\n    };\r\n\r\n    return '#' + rgb.map(toHex).join('').toUpperCase();\r\n  }\r\n\r\n  // https://stackoverflow.com/a/43508395/12787\r\n  #getBrightest(colors: Array<RGBColor>): RGBColor {\r\n    const luminance = (rgb: RGBColor): number => {\r\n      const gamma = (c: number) => (c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4));\r\n      const [r, g, b] = rgb;\r\n      return 0.2126 * gamma(r / 255) + 0.7152 * gamma(g / 255) + 0.0722 * gamma(b / 255);\r\n    };\r\n\r\n    let idx = 0;\r\n    let lightest = luminance(colors[0]);\r\n\r\n    for (let i = 1; i < colors.length; i++) {\r\n      const current = luminance(colors[i]);\r\n      if (lightest < current) {\r\n        lightest = current;\r\n        idx = i;\r\n      }\r\n    }\r\n\r\n    return colors[idx];\r\n  }\r\n\r\n  #getTemporaryImageSrc() {\r\n    // HACK: Here be dragons! Insanity-level DOM traversal ahead! Only the brave know how to forgive. [LK]\r\n    // NOTE: This is very fragile and relies on the current structure of Umbraco's DOM. [LK]\r\n    const tempImg = this.getRootNode()\r\n      // @ts-ignore\r\n      ?.host?.getRootNode()\r\n      // @ts-ignore\r\n      ?.host?.getRootNode()\r\n      // @ts-ignore\r\n      ?.host?.getRootNode()\r\n      // @ts-ignore\r\n      ?.host?.shadowRoot?.querySelector('umb-content-workspace-property[alias=\"umbracoFile\"]')\r\n      // @ts-ignore\r\n      ?.shadowRoot?.firstElementChild // @ts-ignore\r\n      ?.shadowRoot?.firstElementChild // @ts-ignore\r\n      ?.shadowRoot?.firstElementChild // @ts-ignore\r\n      ?.querySelector('#editor > umb-property-editor-ui-image-cropper')\r\n      ?.shadowRoot?.firstElementChild // @ts-ignore\r\n      ?.shadowRoot?.querySelector('umb-image-cropper-field')\r\n      // @ts-ignore\r\n      ?.shadowRoot?.querySelector('#main')\r\n      // @ts-ignore\r\n      ?.querySelector('umb-image-cropper-focus-setter')\r\n      // @ts-ignore\r\n      ?.shadowRoot?.querySelector('#image') as HTMLImageElement;\r\n\r\n    if (tempImg?.src) {\r\n      this._imgSrc = tempImg.src;\r\n\r\n      if (!this._imgSrc) {\r\n        this.#resetValues();\r\n      }\r\n    }\r\n  }\r\n\r\n  // https://www.reddit.com/r/webdev/comments/1gwhfg0/comment/lyburza/\r\n  #getTextColor(rgb: RGBColor): string {\r\n    const [r, g, b] = rgb;\r\n    return r * g * b - 1 > 0xffffff / 2 ? '#000000' : '#FFFFFF';\r\n  }\r\n\r\n  #invertColor(rgb: RGBColor): RGBColor {\r\n    return rgb.map((c) => 255 - c) as RGBColor;\r\n  }\r\n\r\n  // Extract colors from a 10px radius around the focal point\r\n  #extractColorsFromFocalArea(image: HTMLImageElement, focalPoint: { left: number; top: number }): {\r\n    average: RGBColor;\r\n    brightest: RGBColor;\r\n    palette: Array<RGBColor>;\r\n  } {\r\n    // Create a canvas to work with the image data\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d')!;\r\n\r\n    // Set canvas size to match image\r\n    canvas.width = image.naturalWidth;\r\n    canvas.height = image.naturalHeight;\r\n\r\n    // Draw the image onto the canvas\r\n    ctx.drawImage(image, 0, 0);\r\n\r\n    // Calculate focal point coordinates in pixels\r\n    const focalX = Math.round(focalPoint.left * image.naturalWidth);\r\n    const focalY = Math.round(focalPoint.top * image.naturalHeight);\r\n\r\n    // Define the extraction area (10px radius = 20x20 square)\r\n    const radius = 10;\r\n    const startX = Math.max(0, focalX - radius);\r\n    const startY = Math.max(0, focalY - radius);\r\n    const width = Math.min(radius * 2, image.naturalWidth - startX);\r\n    const height = Math.min(radius * 2, image.naturalHeight - startY);\r\n\r\n    // Extract image data from the focal area\r\n    const imageData = ctx.getImageData(startX, startY, width, height);\r\n    const data = imageData.data;\r\n\r\n    // Collect all pixel colors from the focal area\r\n    const colors: Array<RGBColor> = [];\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      const r = data[i];\r\n      const g = data[i + 1];\r\n      const b = data[i + 2];\r\n      const alpha = data[i + 3];\r\n\r\n      // Only include non-transparent pixels\r\n      if (alpha > 0) {\r\n        colors.push([r, g, b]);\r\n      }\r\n    }\r\n\r\n    // Calculate average color from the focal area\r\n    const totalPixels = colors.length;\r\n    if (totalPixels === 0) {\r\n      // Fallback if no valid pixels found\r\n      return {\r\n        average: [128, 128, 128],\r\n        brightest: [255, 255, 255],\r\n        palette: [[128, 128, 128], [255, 255, 255], [0, 0, 0]]\r\n      };\r\n    }\r\n\r\n    const avgR = Math.round(colors.reduce((sum, color) => sum + color[0], 0) / totalPixels);\r\n    const avgG = Math.round(colors.reduce((sum, color) => sum + color[1], 0) / totalPixels);\r\n    const avgB = Math.round(colors.reduce((sum, color) => sum + color[2], 0) / totalPixels);\r\n\r\n    const average: RGBColor = [avgR, avgG, avgB];\r\n\r\n    // Get brightest color from the area\r\n    const brightest = this.#getBrightest(colors);\r\n\r\n    // Create a diverse palette by sampling colors and adding some variety\r\n    const palette: Array<RGBColor> = [];\r\n\r\n    // Add the average and brightest\r\n    palette.push(average);\r\n    palette.push(brightest);\r\n\r\n    // Sample additional colors from the focal area\r\n    for (let i = 0; i < Math.min(colors.length, 10); i += Math.max(1, Math.floor(colors.length / 8))) {\r\n      palette.push(colors[i]);\r\n    }\r\n\r\n    // Add some calculated variations\r\n    palette.push(this.#invertColor(average));\r\n    palette.push([Math.min(255, avgR + 40), Math.min(255, avgG + 40), Math.min(255, avgB + 40)]);\r\n    palette.push([Math.max(0, avgR - 40), Math.max(0, avgG - 40), Math.max(0, avgB - 40)]);\r\n\r\n    return { average, brightest, palette };\r\n  }\r\n\r\n  // Calculate and update colors based on current focal point\r\n  #calculateColors() {\r\n    if (!this._previewImage) return;\r\n\r\n    let average: RGBColor;\r\n    let brightest: RGBColor;\r\n    let palette: Array<RGBColor>;\r\n\r\n    // Use focal point-based extraction if focal point is available\r\n    if (this._focalPoint) {\r\n      const focalColors = this.#extractColorsFromFocalArea(this._previewImage, this._focalPoint);\r\n      average = focalColors.average;\r\n      brightest = focalColors.brightest;\r\n      palette = focalColors.palette;\r\n    } else {\r\n      // Fallback to original ColorThief method for entire image\r\n      average = this.#colorThief.getColor(this._previewImage);\r\n      palette = this.#colorThief.getPalette(this._previewImage, 20, 10);\r\n      brightest = this.#getBrightest(palette);\r\n    }\r\n\r\n    const opposite = this.#invertColor(average);\r\n\r\n    this._average = this.#convertRgbToHex(average);\r\n    this._brightest = this.#convertRgbToHex(brightest);\r\n    this._opposite = this.#convertRgbToHex(opposite);\r\n    this._textColour = this.#getTextColor(average);\r\n\r\n    // Build object and canonical raw JSON string\r\n    const obj: MediaColorFinderValue = {\r\n      average: this._average,\r\n      brightest: this._brightest,\r\n      opposite: this._opposite,\r\n      textColour: this._textColour,\r\n    };\r\n\r\n    const raw = JSON.stringify(obj);\r\n\r\n    // Only update/persist if it changed\r\n    if (raw !== this.#lastRawValue) {\r\n      this.#value = obj;\r\n      this.#rawValue = raw;\r\n      this.#lastRawValue = raw;\r\n\r\n      // Set element value (raw string) so Umbraco reads it, then notify via UmbChangeEvent (no args).\r\n      // Note: do NOT pass payload to UmbChangeEvent â€” Umbraco will read the element.value.\r\n      this.value = raw;\r\n      this.dispatchEvent(new UmbChangeEvent());\r\n    }\r\n  }\r\n\r\n  #onImgLoad() {\r\n    if (!this._previewImage) return;\r\n    // Calculate colors using the extracted method\r\n    this.#calculateColors();\r\n  }\r\n\r\n  #resetValues() {\r\n    this._average = undefined;\r\n    this._brightest = undefined;\r\n    this._opposite = undefined;\r\n    this._textColour = undefined;\r\n\r\n    this.#value = undefined;\r\n    this.#rawValue = undefined;\r\n    this.#lastRawValue = undefined;\r\n\r\n    // Notify Umbraco the value is cleared\r\n    this.value = undefined;\r\n    this.dispatchEvent(new UmbChangeEvent());\r\n  }\r\n\r\n  override render() {\r\n    if (!this._imgSrc) return html`<p><em>Please select an image to extract the colors.</em></p>`;\r\n\r\n    const isFocalPointBased = this._focalPoint && (this._focalPoint.left !== 0.5 || this._focalPoint.top !== 0.5);\r\n\r\n    return html`\r\n\t\t\t<img id=\"preview\" hidden src=${this._imgSrc} alt=\"\" @load=${this.#onImgLoad} />\r\n\t\t\t${isFocalPointBased ? html`\r\n\t\t\t\t<p style=\"font-size: 0.8em; color: #666; margin-bottom: 8px;\">\r\n\t\t\t\t\t<uui-icon name=\"icon-target\"></uui-icon>\r\n\t\t\t\t\tColors extracted from 10px radius around focal point (${Math.round(this._focalPoint!.left * 100)}%, ${Math.round(this._focalPoint!.top * 100)}%)\r\n\t\t\t\t</p>\r\n\t\t\t` : html`\r\n\t\t\t\t<p style=\"font-size: 0.8em; color: #666; margin-bottom: 8px;\">\r\n\t\t\t\t\t<uui-icon name=\"icon-palette\"></uui-icon>\r\n\t\t\t\t\tColors extracted from entire image\r\n\t\t\t\t</p>\r\n\t\t\t`}\r\n\t\t\t<uui-color-swatches readonly>\r\n\t\t\t\t${this.#renderColor('Average', this._average)} ${this.#renderColor('Brightest', this._brightest)}\r\n\t\t\t\t${this.#renderColor('Opposite', this._opposite)} ${this.#renderColor('Text color', this._textColour)}\r\n\t\t\t</uui-color-swatches>\r\n\t\t`;\r\n  }\r\n\r\n  #renderColor(label: string, color?: string) {\r\n    if (!color) return nothing;\r\n    return html`<uui-color-swatch show-label label=${label} value=${color}></uui-color-swatch>`;\r\n  }\r\n}\r\n\r\nexport { WscPropertyEditorUIMediaColorFinderElement as element };\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'property-editor-ui-media-colour-finder': WscPropertyEditorUIMediaColorFinderElement;\r\n  }\r\n}\r\n"],"names":["t","r","n","o","e","i","u","a","c","f","s","h","v","l","g","p","b","m","d","w","_colorThief","_previousFocalPoint","_value","_rawValue","_lastRawValue","_WscPropertyEditorUIMediaColorFinderElement_instances","convertRgbToHex_fn","getBrightest_fn","getTemporaryImageSrc_fn","getTextColor_fn","invertColor_fn","extractColorsFromFocalArea_fn","calculateColors_fn","onImgLoad_fn","resetValues_fn","renderColor_fn","WscPropertyEditorUIMediaColorFinderElement","UmbLitElement","__privateAdd","ColorThief","value","__privateSet","__privateGet","config","UMB_PROPERTY_DATASET_CONTEXT","propertyDatasetContext","imageCropper","newFocalPoint","focalPointChanged","__privateMethod","srcChanged","html","isFocalPointBased","rgb","toHex","hex","colors","luminance","gamma","idx","lightest","current","tempImg","image","focalPoint","canvas","ctx","focalX","focalY","radius","startX","startY","width","height","data","totalPixels","avgR","sum","color","avgG","avgB","average","brightest","palette","focalColors","opposite","obj","raw","UmbChangeEvent","label","nothing","__decorateClass","state","query","property","customElement"],"mappings":"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","x_google_ignoreList":[0]}